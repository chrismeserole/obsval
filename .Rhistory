library(obsval)
devtools::test()
df <- read.csv("/Users/cmes/Downloads/AFdatasubset.csv")
head(df)
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.age + x.ethnic + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region) + (1|x.country), data = df, family = binomial, nAGQ = 1)
print(m, corr=FALSE)
import(lmer)
library(lmer)
library(lme4)
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.age + x.ethnic + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region) + (1|x.country), data = df, family = binomial, nAGQ = 1)
print(m, corr=FALSE)
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.age + x.ethnic + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region), data = df, family = binomial, nAGQ = 1)
tmpdat <- df[,]
jvalues <- with(df, seq(from = min(x.cinsecure2), to = max(x.cinsecure2), length.out = 2))
pp <- lapply(jvalues, function(j) {
tmpdat$x.cinsecure2 <- j
predict(m, newdata = tmpdat, type = "response")
})
head(pp)
sapply(pp[c(1, 2)], mean)
plotdat <- t(sapply(pp, function(x) {
c(M = mean(x), quantile(x, c(0.25, 0.75)))
}))
pp[1:2]
pp[[1]][1:2]
plotdat <- as.data.frame(cbind(plotdat, jvalues))
colnames(plotdat) <- c("PredictedProbability", "Lower", "Upper", "Insecurity")
head(plotdat)
df.plot <- data.frame(pp,x.cinsecure2)
df.plot <- data.frame(pp,df$x.cinsecure2)
library(ggplot2)
ggplot(plotdat2, aes(x = x.cinsecure2, y = PredictedProbability))
ggplot(df.plot, aes(x = x.cinsecure2, y = pp))
df.plot <- data.frame(pp,df$x.cinsecure2, df$x.country)
ggplot(df.plot, aes(x = x.cinsecure2, y = pp)) +
geom_line(aes(colour=x.country))
df.plot <- data.frame(pp,df$x.cinsecure2, df$x.country)
library(ggplot2)
ggplot(df.plot, aes(x = x.cinsecure2, y = pp)) +
geom_line(aes(colour=x.country))
df <- read.csv("/Users/cmes/Downloads/AFdatasubset.csv")
head(df)
df.plot <- data.frame(pp,df$x.cinsecure2, df$x.country)
ggplot(df.plot, aes(x = x.cinsecure2, y = pp)) +
geom_line(aes(colour=df.plot$x.country))
df.plot <- as.matrix(data.frame(pp,df$x.cinsecure2, df$x.country))
ggplot(df.plot, aes(x = x.cinsecure2, y = pp)) +
geom_line(aes(colour=df.plot$x.country))
ggplot(df.plot, aes(x = x.cinsecure2, y = pp)) +
geom_line(aes(colour=df.plot$x.country))
df.plot <- data.frame(pp,df$x.cinsecure2, df$x.country))
df.plot <- data.frame(pp,df$x.cinsecure2, df$x.country)
ggplot(df.plot, aes(x = x.cinsecure2, y = pp)) +
geom_line(aes(colour=df.plot$x.country))
ggplot(df.plot, aes(x = df.plot$x.cinsecure2, y = pp)) +
geom_line(aes(colour=df.plot$x.country))
n <- 100
x1.a <- rnorm(n); b0.a <- .2; b1.a <- .-3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
x2.a <- rnorm(n); b0.b <- -.5; b1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
x2.a <- rnorm(n); b0.b <- -.5; x1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
n <- 100
x1.a <- rnorm(n); b0.a <- .2; b1.a <- .-3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
x2.a <- rnorm(n); b0.b <- -.5; x1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
y.probs <- c(y.prob.a, y.prob.b)
x1s <- c(x1.a, x1.b)
country <- c(rep("UK",n),rep("FR",n))
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
x1.a <- rnorm(n); b0.a <- .2; b1.a <- .-3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
x1.a <- rnorm(n); b0.a <- .2; b1.a <- .-3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
b1.a <- .-3
b1.a <- -.3
x1.a <- rnorm(n); b0.a <- .2; b1.a <- -.3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
x2.a <- rnorm(n); b0.b <- -.5; x1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
y.probs <- c(y.prob.a, y.prob.b)
x1s <- c(x1.a, x1.b)
country <- c(rep("UK",n),rep("FR",n))
df.plot <- data.frame(y.probs, x1s, country)
x1s <- c(x1.a, x1.b)
x1s
x1.b <- rnorm(n); b0.b <- -.5; b1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
y.probs <- c(y.prob.a, y.prob.b)
x1s <- c(x1.a, x1.b)
country <- c(rep("UK",n),rep("FR",n))
df.plot <- data.frame(y.probs, x1s, country)
ggplot(df.plot, aes(x = x1s, y = y.probs)) +
geom_line(aes(colour=country))
country.b <- rep("FR",n)
x1.c <- rnorm(n); b0.c <- 1; b1.c <- -.8
y.prob.c <- exp(b0.c + b1.c*x1.c)/(1+exp(b0.c + b1.c*x1.c))
country.c <- rep("GER",n)
n <- 100
x1.a <- rnorm(n); b0.a <- .2; b1.a <- -.3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
country.a <- rep("UK",n)
x1.b <- rnorm(n); b0.b <- -.5; b1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
country.b <- rep("FR",n)
x1.c <- rnorm(n); b0.c <- 1; b1.c <- -.8
y.prob.c <- exp(b0.c + b1.c*x1.c)/(1+exp(b0.c + b1.c*x1.c))
country.c <- rep("GER",n)
y.probs <- c(y.prob.a, y.prob.b, y.prob.c)
x1s <- c(x1.a, x1.b, x1.c)
country <- c(country.a, country.b, country.c)
y.probs <- c(y.prob.a, y.prob.b)
x1s <- c(x1.a, x1.b)
country <- c(country.a, country.b)
df.plot <- data.frame(y.probs, x1s, country)
ggplot(df.plot, aes(x = x1s, y = y.probs)) +
geom_line(aes(colour=country))
df.plot <- data.frame(y.probs, x1s, country)
ggplot(df.plot, aes(x = x1s, y = y.probs)) +
geom_line(aes(colour=country))
y.probs <- c(y.prob.a, y.prob.b, y.prob.c)
x1s <- c(x1.a, x1.b, x1.c)
country <- c(country.a, country.b, country.c)
df.plot <- data.frame(y.probs, x1s, country)
ggplot(df.plot, aes(x = x1s, y = y.probs)) +
geom_line(aes(colour=country))
x1.a <- rbinom(n); b0.a <- .2; b1.a <- -.3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
country.a <- rep("UK",n)
x1.b <- rbinom(n); b0.b <- -.5; b1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
country.b <- rep("FR",n)
x1.c <- rbinom(n); b0.c <- 1; b1.c <- -.8
y.prob.c <- exp(b0.c + b1.c*x1.c)/(1+exp(b0.c + b1.c*x1.c))
country.c <- rep("GER",n)
x1.a <- rbinom(n,1); b0.a <- .2; b1.a <- -.3
x1.a <- rbinom(n,1,.7); b0.a <- .2; b1.a <- -.3
n <- 100
x1.a <- rbinom(n, 1, .7); b0.a <- .2; b1.a <- -.3
y.prob.a <- exp(b0.a + b1.a*x1.a)/(1+exp(b0.a + b1.a*x1.a))
country.a <- rep("UK",n)
x1.b <- rbinom(n, 1, .2); b0.b <- -.5; b1.b <- .8
y.prob.b <- exp(b0.b + b1.b*x1.b)/(1+exp(b0.b + b1.b*x1.b))
country.b <- rep("FR",n)
x1.c <- rbinom(n, 1, .4 ); b0.c <- 1; b1.c <- -.8
y.prob.c <- exp(b0.c + b1.c*x1.c)/(1+exp(b0.c + b1.c*x1.c))
country.c <- rep("GER",n)
y.probs <- c(y.prob.a, y.prob.b, y.prob.c)
x1s <- c(x1.a, x1.b, x1.c)
country <- c(country.a, country.b, country.c)
df.plot <- data.frame(y.probs, x1s, country)
ggplot(df.plot, aes(x = x1s, y = y.probs)) +
geom_line(aes(colour=country))
foo <- c("White", "Red", "Blue", "Blue", "Red", "White", "White")
foo.ind <- foo.var[foo.var==foo.vals[1]]
foo.var <- c("White", "Red", "Blue", "Blue", "Red", "White", "White")
foo.vals <- c("Red", "Blue")
foo.ind <- foo.var[foo.var==foo.vals[1]]
foo.ind
foo.ind <- (foo.var==foo.vals[1])
foo.ind
foo.var <- as.integer(foo.var)
foo.var <- c("White", "Red", "Blue", "Blue", "Red", "White", "White")
foo.var <- as.integer(foo.var)
foo.var
foo.var <- factor(c("White", "Red", "Blue", "Blue", "Red", "White", "White"))
foo.var <- as.integer(foo.var)
foo.var
foo.var <- c("White", "Red", "Blue", "Blue", "Red", "White", "White")
type(foo.var)
typeof(foo.var)
class(foo.var)
foo.var <- factor(foo.var)
typeof(foo.var)
class(foo.var)
foo.vals[1] <- foo.var[foo.ind]
foo.vals[1] <- unique(foo.var[foo.ind])
foo.vals
foo.vals.ind <- (foo.vals %in% foo.var)
foo.vals.ind
foo.var <- c("White", "Red", "Blue", "Blue", "Red", "White", "White")
foo.vals <- c("Red", "Blue")
foo.vals.ind <- (foo.var %in% foo.val)
foo.vals.ind <- (foo.var %in% foo.vals)
foo.vals.ind
apply(foo.vals, function(x) paste(x, "hi", sep=""))
apply(foo.vals, 1, function(x) paste(x, "hi", sep=""))
?apply
x <- cbind(x1 = 3, x2 = c(4:1, 2:5))
dimnames(x)[[1]] <- letters[1:8]
apply(x, 2, mean, trim = .2)
x <- cbind(x1 = 3, x2 = c(4:1, 2:5))
dimnames(x)[[1]] <- letters[1:8]
x
apply(x, 2, mean, trim = .2)
apply(x, 2, function(x) x+3)
y <- c(2,10)
apply(y, 2, function(x) x+3)
y <- as.vector(c(2,10))
apply(y, 2, function(x) x+3)
lapply
?.Internal
browseOnce <- function() {
old <- getOption("error")
function() {
options(error = old)
browser()
}
}
options(error = browseOnce())
f <- function() stop("!")
f()
f()
?with
library(MASS)
with(anorexia, {
anorex.1 <- glm(Postwt ~ Prewt + Treat + offset(Prewt),
family = gaussian)
summary(anorex.1)
})
anorex.1
anorexia
?match
match(foo.vals, foo.var)
foo.var <- c("White", "Red", "Blue", "Blue", "Red", "White", "White")
foo.vals <- c("Red", "Blue")
match(foo.vals, foo.var)
foo.var(match(foo.vals, foo.var))
foo.var[match(foo.vals, foo.var)]
index.pos <- match(foo.vals, foo.var)
foo.var <- factor(c("White", "Red", "Blue", "Blue", "Red", "White", "White"))
index.pos <- match(foo.vals, foo.var)
foo.var <- factor(c("White", "Red", "Blue", "Blue", "Red", "White", "White"))
foo.vals <- c("Red", "Blue")
index.pos <- match(foo.vals, foo.var)
foo.var <- as.integer(foo.var)
foo.vals <- foo.var[index.pos]
foo.vals
foo.var
?factor
foo.var <- factor(c("White", "Red", "Blue", "Blue", "Red", "White", "White"))
foo.vals <- c("Red", "Pink")
index.pos <- match(foo.vals, foo.var)
foo.var <- as.integer(foo.var)
foo.vals <- foo.var[index.pos]
foo.vals
af.data <- read.csv("/Users/cmes/Downloads/AFdata.csv")
data2 <- read.csv("/Users/cmes/Downloads/AFdata.csv")
y.vfear2=data2$vfear2
x.cinsecure2=data2$cinsecure2
x.age=data2$age
x.ethnic=data2$ethnic
x.urbrur=data2$urbrur
x.wealth2=data2$wealth2
x.female=data2$female
x.educ2=data2$educ2
x.relig2=data2$relig2
x.region=data2$region
x.country=data2$country_alpha
df <- data.frame(y.vfear2, x.region, x.country, x.cinsecure2, x.age, x.ethnic, x.region, x.country, x.urbrur, x.wealth2, x.female, x.educ2, x.relig2)
head(df)
df <- data.frame(y.vfear2, x.region, x.country, x.cinsecure2, x.age, x.ethnic, x.region, x.country, x.urbrur, x.wealth2, x.female, x.educ2, x.relig2)
y.vfear2=data2$vfear2
y.vfear2
y.vfear2 <- data2$vfear2
y.vfear2
(head(data2))
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.age + x.ethnic + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region) + (1|x.country), data = df, family = binomial, nAGQ = 1)
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.age + x.ethnic + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region) + (1|x.country), data = df, family = binomial, nAGQ = 1)
names(df)
df <- read.csv("/Users/cmes/Downloads/AFdata.csv")
names(df)
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.age + x.ethnic + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region) + (1|x.country), data = df, family = binomial, nAGQ = 1)
is.object(m)
names(m)
?s4
summary(m)
summary(df)
unique(x.ethnic)
unique(df$x.ethnic)
summary(df$x.age)
table(x.age)
table(df$x.age)
sort(table(df$x.ethnic)
sort(table(df$x.ethnic))
sort(table(df$x.ethnic))
sort(table(df$x.ethnic),desc=TRUE)
?sort
sort(table(df$x.ethnic),decreasing=TRUE)
m <- glmer(y.vfear2 ~ x.cinsecure2 + x.urbrur + x.wealth2 + x.female + x.educ2 + x.relig2 +
(1 |x.region) + (1|x.country), data = df, family = binomial, nAGQ = 1)
table(df$x.relig2)
summary(m)
tmpdat <- df[ , ]
jvalues <- with(df, seq(from = min(x.cinsecure2), to = max(x.cinsecure2), length.out = 2))
head(jvalues)
pp <- lapply(jvalues, function(j) {
tmpdat$x.cinsecure2 <- j
predict(m, newdata = tmpdat, type = "response")
})
sapply(pp[c(1, 2)], mean)
head(pp)
sapply(pp, mean)
plotdat <- t(sapply(pp, function(x) {
c(M = mean(x), quantile(x, c(0.25, 0.75)))
}))
head(plotdat)
plotdat <- as.data.frame(cbind(plotdat, jvalues))
head(plotdat)
colnames(plotdat) <- c("PredictedProbability", "Lower", "Upper", "Insecurity")
head(plotdat)
dotchart(ranef(m, which = x.region, condVar = FALSE), scales = list(y = list(alternating = 0)))
dotchart(ranef(m, which = x.country, condVar = TRUE))
?dotchart
dotchart(VADeaths, main = "Death Rates in Virginia - 1940")
op <- par(xaxs = "i")  # 0 -- 100%
dotchart(t(VADeaths), xlim = c(0,100),
main = "Death Rates in Virginia - 1940")
par(op)
head(VADeaths)
ranef(m)
dotchart(ranef(m, which = x.country, condVar = TRUE))
ranef(m, which = x.country)
?which
dotchart(ranef(m, which = df$x.country, condVar = TRUE))
dotchart(ranef(m, which = factor(df$x.country), condVar = TRUE))
?ranef
dotchart(ranef(m, which = as.character(x.country), condVar = TRUE))
class(m)
ha <- ranef(m, which = as.character(x.country), condVar = TRUE))
ha <- ranef(m, which = as.character(x.country), condVar = TRUE)
dotchart(m)
ha
ha <- ranef(m, which = x.country, condVar = TRUE)
ha <- ranef(m, which = as.character(x.country), condVar = TRUE)
head(ha)
summary(ha)
ha <- as.numeric(ranef(m, which = as.character(x.country), condVar = TRUE))
dotchart(ha)
summary(ha)
ha <- ranef(m, which = as.character(x.country))
ha
summary(ha)
?ranef
str(rr1 <- ranef(m, condVar = TRUE))
dotplot(rr1)
dotchart(rr1)
biprobs <- lapply(levels(df$x.country), function(stage) {
tmpdat$x.country[] <- stage
lapply(jvalues, function(j) {
tmpdat$x.cinsecure2 <- j
predict(m, newdata = tmpdat, type = "response")
})
})
head(biprobs)
names(biprobs)
biprobs
summary(biprobs)
table(df$country)
table(df$x.country)
is.factor(df$x.country)
head(plotdat)
head(pp)
dim(pp)
length(pp)
length(pp[,1])
pp
unique(pp)
length(pp)
typeof(pp)
length(unlist(pp))
result.pp <- as.matrix(pp, ncol=2)
head(result.pp)
result.pp <- as.matrix(unlist(pp), ncol=2)
head(result.pp)
length(unlist(pp))
pp1 <- unlist(pp)[1:length(df$x.country)]
n.obs <- length(df$x.country)
pp1 <- unlist(pp)[(n.obs+1):(2*n.obs)]
pp1 <- unlist(pp)[1:n.obs]
pp2 <- unlist(pp)[(n.obs+1):(2*n.obs)]
summary(pp1)
summary(pp2)
summary(pp[1])
summary(pp[,1])
summary(pp[1,])
summary(pp[[1]])
pp1 <- unlist(pp[[1]])
summary(pp1)
pp2 <- unlist(pp[[2]])
(pp2)
summary(pp[[2]])
pp2 <- unlist(pp[[2]])
pp <- unlist(pp)
df.plot <- data.frame(pp, x.cin, x.cty)
x.cin <- rep(df$x.cinsecure2,2)
df.plot <- data.frame(pp, x.cin, x.cty)
x.cty <- rep(factor(df$x.country),2)
x.cin <- rep(df$x.cinsecure2,2)
df.plot <- data.frame(pp, x.cin, x.cty)
ggplot(df.plot, aes(x = df.plot$x.cinsecure2, y = pp)) +
geom_line(aes(colour=df.plot$x.country))
ggplot(df.plot, aes(x = x.cin, y = pp)) +
geom_line(aes(colour=x.cty))
?lapply
jvalues <- with(df, seq(from = min(x.cinsecure2),
to = max(x.cinsecure2),
length.out = 2))
jvalues
jvalues <- c(min(df$x.cinsecure2), max(f$x.cinsecure2))
jvalues <- c(min(df$x.cinsecure2), max(df$x.cinsecure2))
jvalues
setwd("/Users/cmes/Dropbox/Data/OSVPAP")
load("MeseroleReplication 2015-08-23 153318.RData")
controlVars <- c("war", "democ", "support","democ_supdum","loot","lngov","tc",
"fightmod","laglnpop","duration","lagreb2010")
fixed.fmla <- paste('y.vfear2 ~ relOrg + ', controlVars, sep="")
full.fmla <- paste(fixed.fmla, ' + (1 | DyadID)', sep="")
m <- glmer.nb(full.fmla, data = df)
fixed.fmla <- paste('rebbest2010 ~ relOrg + ', controlVars, sep="")
full.fmla <- paste(fixed.fmla, ' + (1 | DyadID)', sep="")
m <- glmer.nb(full.fmla, data = df)
summary(m)
?collapse
?concat
?concatenate
m <- glmer.nb(full.fmla, data = df)
summary(m)
fixed.fmla <- 'rebbest2010 ~ relOrg + war + democ + support + democ_supdum +
loot + lngov + tc +  fightmod + laglnpop +
duration + lagreb2010 + (1 | DyadID)'
m <- glmer.nb(full.fmla, data = df)
fmla <- 'rebbest2010 ~ relOrg + war + democ + support + democ_supdum +
loot + lngov + tc +  fightmod + laglnpop +
duration + lagreb2010 + (1 | DyadID)'
m <- glmer.nb(fmla, data = df)
ranef(m)
coef(m)
0^(1/4)
df$lagreb2010 <- df$lagreb2010^(1/4)
df$rebbest2010 <- df$rebbest2010^(1/4)
m2 <- glmer.nb(fmla, data = df)
m2 <- glmer.nb(fmla, data = df)
load("MeseroleReplication 2015-08-23 153318.RData")
fmla <- 'rebbest2010 ~ relOrg + war + democ + support + democ_supdum +
loot + lngov + tc +  fightmod + laglnpop +
duration + lagreb2010 + (1 | DyadID)'
df$rebbest2010 <- df$rebbest2010^(1/2)
df$lagreb2010 <- df$lagreb2010^(1/2)
m2 <- glmer.nb(fmla, data = df)
load("MeseroleReplication 2015-08-23 153318.RData")
fmla <- 'rebbest2010 ~ relOrg + war + democ + support + democ_supdum +
loot + lngov + tc +  fightmod + laglnpop +
duration + lagreb2010 + (1 | DyadID)'
df$rebbest2010 <- round(df$rebbest2010^(1/2))
df$lagreb2010 <- ruond(df$lagreb2010^(1/2))
m2 <- glmer.nb(fmla, data = df)
df$rebbest2010 <- round(df$rebbest2010^(1/2))
df$lagreb2010 <- round(df$lagreb2010^(1/2))
m2 <- glmer.nb(fmla, data = df)
m2 <- glmer.nb(fmla, data = df, control = glm.control(trace <- 6))
m2 <- glmer.nb(fmla, data = df, trace <- 6)
m2 <- glmer.nb(fmla, data = df, verbose=T)
warnings()
summary(m)
summary(m2)
?simulate
yb1 <- matrix(c(4, 4, 5, 7, 8, 6, 6, 5, 3, 2), ncol = 2)
yb1
modb1 <- glm(yb1 ~ x, family = binomial)
mod1 <- lm(c(1:3, 7, 6) ~ x)
x <- 1:5
mod1 <- lm(c(1:3, 7, 6) ~ x)
S1 <- simulate(mod1, nsim = 4)
S1
df <- read.csv("/Users/cmes/Downloads/AFdata.csv")
head(df)
